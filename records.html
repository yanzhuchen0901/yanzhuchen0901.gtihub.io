<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥è®°å½•ç³»ç»Ÿ - è®°å½•é¡µ</title>

    <meta http-equiv="Cache-Control" content="no-store" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <link rel="stylesheet" href="static/header.css">
    <link rel="stylesheet" href="static/styles.css">
</head>

<body>

    <header id="header">
        <div style="display:flex; align-items:center; gap:12px; width:100%; max-width:1100px; justify-content:space-between;">
            <div style="font-weight:bold; font-size:18px;">Chen.ã®homepage</div>
            <div>
                <a href="index.html" class="nav-btn">è¿”å›é¦–é¡µ</a>
                <a href="https://yanzhuchen0901.github.io/notes/" class="nav-btn" target="_blank" rel="noopener noreferrer">ç¬”è®°</a>
            </div>
        </div>
    </header>

    <section class="hero">
        <h1>ğŸ”¥ æ¯æ—¥è®°å½•ï¼ˆç‹¬ç«‹é¡µé¢ï¼‰</h1>
    </section>

    <div class="daily-record-container">
        <div class="date-display">
            <span id="currentDate"></span>
            <button class="btn btn-warning" onclick="goToToday()">ğŸ“… ä»Šå¤©</button>
            <button class="btn btn-primary" onclick="previousDay()">â† å‰ä¸€å¤©</button>
            <button class="btn btn-primary" onclick="nextDay()">åä¸€å¤© â†’</button>
        </div>

        <div class="btn-group">
            <button class="btn btn-success" onclick="saveRecord()">ğŸ’¾ ä¿å­˜</button>
            <button class="btn btn-primary" onclick="exportRecord()">ğŸ“¥ å¯¼å‡ºçº¯æ–‡æœ¬</button>
            <button class="btn btn-warning" onclick="startFocusMode()">ğŸ¯ ä¸“æ³¨æ¨¡å¼</button>
        </div>

        <div class="section-title">ğŸ·ï¸ å…³é”®è¯ï¼ˆå¯é€‰ï¼‰</div>
        <div class="input-group">
            <input type="text" id="keywordInput" placeholder="è¾“å…¥å…³é”®è¯ï¼ŒæŒ‰å›è½¦æ·»åŠ " onkeypress="if(event.key==='Enter') addKeyword()">
            <button class="btn btn-primary" onclick="addKeyword()">æ·»åŠ </button>
        </div>
        <div class="keywords-container" id="keywordsContainer"></div>

        <div class="section-title">âœ… ä»Šå¤©åšäº†ä»€ä¹ˆ</div>
        <textarea id="todayDone" placeholder="è®°å½•ä»Šå¤©å®Œæˆçš„äº‹é¡¹..."></textarea>

        <div class="section-title">ğŸ“‹ æ˜å¤©æ‰“ç®—åš</div>
        <div class="input-group">
            <input type="text" id="tomorrowInput" placeholder="è¾“å…¥æ˜å¤©çš„è®¡åˆ’ï¼ŒæŒ‰å›è½¦æ·»åŠ " onkeypress="if(event.key==='Enter') addTomorrowPlan()">
            <button class="btn btn-primary" onclick="addTomorrowPlan()">æ·»åŠ </button>
            <button class="btn btn-primary" onclick="suggestPlans()">ğŸ¤– AIå»ºè®®</button>
        </div>
        <ul class="tomorrow-list" id="tomorrowList"></ul>
        <div id="aiSuggestions" class="ai-suggestions" style="display:none;">
            <h4>AIå»ºè®®çš„æ˜å¤©è®¡åˆ’ï¼š</h4>
            <ul class="ai-suggestions-list" id="suggestionsList"></ul>
        </div>

        <div class="section-title">ğŸ“ å¾…åŠæ¸…å• (To-Do List)</div>
        <div class="input-group">
            <input type="text" id="todoInput" placeholder="æ·»åŠ å¾…åŠé¡¹ç›®" onkeypress="if(event.key==='Enter') addTodo()">
            <button class="btn btn-primary" onclick="addTodo()">æ·»åŠ </button>
        </div>
        <ul class="todo-list" id="todoList"></ul>

        <div class="section-title">ğŸ’­ æ„Ÿæ‚Ÿï¼ˆå¯é€‰ï¼‰</div>
        <textarea id="insights" placeholder="è®°å½•ä»Šå¤©çš„æ„Ÿæ‚Ÿã€æ€è€ƒæˆ–åæ€..."></textarea>

        <div class="section-title">â±ï¸ ä¸“æ³¨æ¨¡å¼ç»Ÿè®¡</div>
        <div class="stats-panel">
            <div class="stat-item">
                <span class="stat-label">ä»Šæ—¥ä¸“æ³¨æ€»æ—¶é•¿ï¼š</span>
                <span class="stat-value" id="totalFocusTime">0 åˆ†é’Ÿ</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ä¸“æ³¨æ¬¡æ•°ï¼š</span>
                <span class="stat-value" id="focusCount">0 æ¬¡</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">å¹³å‡ä¸“æ³¨æ—¶é•¿ï¼š</span>
                <span class="stat-value" id="avgFocusTime">0 åˆ†é’Ÿ</span>
            </div>
            <div id="focusSessions" style="margin-top: 15px;"></div>
        </div>

        <div class="btn-group" style="margin-top: 30px;">
            <button class="btn btn-success" onclick="saveRecord()">ğŸ’¾ ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
            <button class="btn btn-primary" onclick="exportRecord()">ğŸ“¥ å¯¼å‡ºä¸ºçº¯æ–‡æœ¬</button>
        </div>
    </div>

    <!-- ä¸“æ³¨æ¨¡å¼çª—å£ -->
    <div class="focus-mode" id="focusMode">
        <button class="btn btn-danger" style="position: absolute; top: 20px; right: 20px;" onclick="exitFocusMode()">é€€å‡º (ESC)</button>
        <div class="focus-task" id="focusTask">èšç„¦ä»»åŠ¡</div>
        <div class="focus-timer" id="focusTimer">25:00</div>
        <div class="focus-controls">
            <button class="btn btn-success" onclick="startTimer()">â–¶ å¼€å§‹</button>
            <button class="btn btn-warning" onclick="pauseTimer()">â¸ æš‚åœ</button>
            <button class="btn btn-danger" onclick="resetTimer()">ğŸ”„ é‡ç½®</button>
        </div>
        <div class="focus-stats">
            <div>âœ… ä»Šå¤©ä¸“æ³¨æ€»æ—¶é•¿: <span id="focusStatTotal">0</span> åˆ†é’Ÿ</div>
            <div>ğŸ“Š æœ¬æ¬¡ä¸“æ³¨: <span id="focusStatCurrent">0</span> åˆ†é’Ÿ</div>
        </div>
    </div>

    <script src="static/data.js"></script>
    <script>
        let currentDate = new Date();
        let focusTimer = null;
        let focusSeconds = 0;
        let focusInitialSeconds = 25 * 60;
        let isTimerRunning = false;
        let currentFocusTask = '';

        // åˆå§‹åŒ–
        function init() {
            goToToday();
        }

        // æ—¥æœŸå¯¼èˆª
        function goToToday() {
            currentDate = new Date();
            loadRecord();
        }

        function previousDay() {
            currentDate.setDate(currentDate.getDate() - 1);
            loadRecord();
        }

        function nextDay() {
            currentDate.setDate(currentDate.getDate() + 1);
            loadRecord();
        }

        function getDateString() {
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function updateDateDisplay() {
            const dateStr = getDateString();
            const weekday = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'][currentDate.getDay()];
            document.getElementById('currentDate').textContent = `ğŸ“… ${dateStr} (${weekday})`;
        }

        // åŠ è½½å’Œä¿å­˜
        function loadRecord() {
            updateDateDisplay();
            const dateStr = getDateString();
            const data = getRecord(dateStr);

            document.getElementById('keywordsContainer').innerHTML = '';
            data.keywords.forEach(k => addKeywordUI(k));

            document.getElementById('todayDone').value = data.today_done || '';
            document.getElementById('insights').value = data.insights || '';

            document.getElementById('tomorrowList').innerHTML = '';
            (data.tomorrow_plan || []).forEach(p => addTomorrowPlanUI(p));

            document.getElementById('todoList').innerHTML = '';
            (data.todos || []).forEach(todo => addTodoUI(todo));

            updateFocusStats(data.focus_sessions || []);
        }

        function saveRecord() {
            const dateStr = getDateString();
            const keywords = Array.from(document.querySelectorAll('.keyword-tag')).map(el =>
                el.textContent.replace('âœ•', '').trim()
            );
            const tomorrowPlans = Array.from(document.querySelectorAll('.tomorrow-item .tomorrow-text')).map(el =>
                el.textContent.trim()
            );
            const todos = Array.from(document.querySelectorAll('.todo-item')).map(el => ({
                text: el.querySelector('.todo-text').textContent.trim(),
                completed: el.querySelector('input[type="checkbox"]').checked
            }));

            const data = {
                date: dateStr,
                keywords: keywords,
                today_done: document.getElementById('todayDone').value,
                tomorrow_plan: tomorrowPlans,
                insights: document.getElementById('insights').value,
                todos: todos,
                focus_sessions: window.focusSessions || []
            };

            saveRecordData(dateStr, data);
            alert('âœ… ä¿å­˜æˆåŠŸï¼');
        }

        // å…³é”®è¯ç®¡ç†
        function addKeyword() {
            const input = document.getElementById('keywordInput');
            if (input.value.trim()) {
                addKeywordUI(input.value.trim());
                input.value = '';
            }
        }

        function addKeywordUI(keyword) {
            const container = document.getElementById('keywordsContainer');
            const tag = document.createElement('div');
            tag.className = 'keyword-tag';
            tag.innerHTML = `${keyword} <button onclick="this.parentElement.remove()">âœ•</button>`;
            container.appendChild(tag);
        }

        // æ˜å¤©è®¡åˆ’ç®¡ç†
        function addTomorrowPlan() {
            const input = document.getElementById('tomorrowInput');
            if (input.value.trim()) {
                addTomorrowPlanUI(input.value.trim());
                input.value = '';
            }
        }

        function addTomorrowPlanUI(plan) {
            const list = document.getElementById('tomorrowList');
            const item = document.createElement('li');
            item.className = 'tomorrow-item';
            item.innerHTML = `
            <div class="tomorrow-text">${plan}</div>
            <button class="btn-remove" onclick="this.parentElement.remove()">åˆ é™¤</button>
        `;
            list.appendChild(item);
        }

        function suggestPlans() {
            const todayDone = document.getElementById('todayDone').value;
            if (!todayDone.trim()) {
                alert('è¯·å…ˆå¡«å†™ä»Šå¤©åšäº†ä»€ä¹ˆï¼ŒAIæ‰èƒ½ç»™å‡ºå»ºè®®ï¼');
                return;
            }

            const suggestions = generatePlanSuggestions(todayDone);
            const suggestionsList = document.getElementById('suggestionsList');
            suggestionsList.innerHTML = '';

            suggestions.forEach(s => {
                const li = document.createElement('li');
                li.innerHTML = `<span onclick="addTomorrowPlanUI('${s.replace(/'/g, "\\'")}'); document.getElementById('aiSuggestions').style.display='none';" style="cursor:pointer; color:#28a745; font-weight:bold;">${s}</span>`;
                suggestionsList.appendChild(li);
            });

            document.getElementById('aiSuggestions').style.display = 'block';
        }

        function generatePlanSuggestions(todayDone) {
            const suggestions = [];

            if (todayDone.includes('ä¼šè®®') || todayDone.includes('è®¨è®º')) {
                suggestions.push('æ•´ç†ä¼šè®®è¦ç‚¹å’Œè¡ŒåŠ¨é¡¹');
            }
            if (todayDone.includes('ä»£ç ') || todayDone.includes('å¼€å‘')) {
                suggestions.push('å¤å®¡ä»£ç å¹¶å®Œæˆå•å…ƒæµ‹è¯•');
            }
            if (todayDone.includes('å­¦ä¹ ')) {
                suggestions.push('å¤ä¹ ä»Šå¤©å­¦ä¹ çš„å†…å®¹');
            }
            if (todayDone.includes('é˜…è¯»')) {
                suggestions.push('æ€»ç»“é˜…è¯»ç¬”è®°');
            }

            suggestions.push('è®¡åˆ’æ˜å¤©çš„é‡ç‚¹ä»»åŠ¡');
            suggestions.push('æ£€æŸ¥é‚®ä»¶å’Œå¾…åŠäº‹é¡¹');
            suggestions.push('å‡†å¤‡æ˜å¤©çš„ä¼šè®®');

            return suggestions.slice(0, 5);
        }

        // å¾…åŠæ¸…å•ç®¡ç†
        function addTodo() {
            const input = document.getElementById('todoInput');
            if (input.value.trim()) {
                addTodoUI({
                    text: input.value.trim(),
                    completed: false
                });
                input.value = '';
            }
        }

        function addTodoUI(todo) {
            const list = document.getElementById('todoList');
            const item = document.createElement('li');
            item.className = 'todo-item' + (todo.completed ? ' completed' : '');
            item.innerHTML = `
            <input type="checkbox" ${todo.completed ? 'checked' : ''} onchange="this.parentElement.classList.toggle('completed')">
            <div class="todo-text">${todo.text}</div>
            <button class="btn-remove" onclick="this.parentElement.remove()">åˆ é™¤</button>
        `;
            list.appendChild(item);
        }

        // ä¸“æ³¨æ¨¡å¼
        function startFocusMode() {
            const input = prompt('è¾“å…¥æœ¬æ¬¡ä¸“æ³¨çš„ä»»åŠ¡ï¼š');
            if (input !== null) {
                currentFocusTask = input || 'ä¸“æ³¨å·¥ä½œ';
                document.getElementById('focusTask').textContent = currentFocusTask;
                focusSeconds = focusInitialSeconds;
                updateFocusDisplay();
                document.getElementById('focusMode').classList.add('active');
                document.addEventListener('keydown', handleFocusKeydown);
            }
        }

        function exitFocusMode() {
            document.getElementById('focusMode').classList.remove('active');
            document.removeEventListener('keydown', handleFocusKeydown);
            if (focusTimer) clearInterval(focusTimer);
            isTimerRunning = false;

            if (focusSeconds < focusInitialSeconds) {
                const duration = Math.round((focusInitialSeconds - focusSeconds) / 60);
                if (duration > 0) {
                    if (!window.focusSessions) window.focusSessions = [];
                    window.focusSessions.push({
                        task: currentFocusTask,
                        duration: duration,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    updateFocusStats(window.focusSessions);
                }
            }
        }

        function handleFocusKeydown(e) {
            if (e.key === 'Escape') exitFocusMode();
        }

        function startTimer() {
            if (isTimerRunning) return;
            isTimerRunning = true;
            focusTimer = setInterval(() => {
                focusSeconds--;
                updateFocusDisplay();
                if (focusSeconds <= 0) {
                    clearInterval(focusTimer);
                    alert('â° ä¸“æ³¨æ—¶é—´ç»“æŸï¼');
                    isTimerRunning = false;
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(focusTimer);
            isTimerRunning = false;
        }

        function resetTimer() {
            clearInterval(focusTimer);
            focusSeconds = focusInitialSeconds;
            isTimerRunning = false;
            updateFocusDisplay();
        }

        function updateFocusDisplay() {
            const minutes = Math.floor(focusSeconds / 60);
            const seconds = focusSeconds % 60;
            document.getElementById('focusTimer').textContent =
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            if (window.focusSessions) {
                const total = window.focusSessions.reduce((sum, s) => sum + s.duration, 0);
                const currentSession = Math.round((focusInitialSeconds - focusSeconds) / 60);
                document.getElementById('focusStatTotal').textContent = total;
                document.getElementById('focusStatCurrent').textContent = currentSession;
            }
        }

        function updateFocusStats(sessions) {
            window.focusSessions = sessions;
            const total = sessions.reduce((sum, s) => sum + s.duration, 0);
            const avg = sessions.length > 0 ? Math.round(total / sessions.length) : 0;

            document.getElementById('totalFocusTime').textContent = `${total} åˆ†é’Ÿ`;
            document.getElementById('focusCount').textContent = `${sessions.length} æ¬¡`;
            document.getElementById('avgFocusTime').textContent = `${avg} åˆ†é’Ÿ`;

            const sessionsHTML = sessions.map(s =>
                `<div style="padding:8px; background:#f0f0f0; margin:5px 0; border-radius:3px;">
                ğŸ• ${s.timestamp} - ${s.task} (${s.duration}åˆ†é’Ÿ)
            </div>`
            ).join('');
            document.getElementById('focusSessions').innerHTML = sessionsHTML || '';
        }

        // å¯¼å‡ºåŠŸèƒ½
        function exportRecord() {
            const dateStr = getDateString();
            const data = getRecord(dateStr);

            let text = `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… æ¯æ—¥è®°å½• - ${data.date}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

`;

            if (data.keywords && data.keywords.length > 0) {
                text += `ğŸ·ï¸  å…³é”®è¯: ${data.keywords.join(', ')}\n\n`;
            }

            text += `âœ… ä»Šå¤©åšäº†ä»€ä¹ˆ:
${data.today_done || ''}

ğŸ“‹ æ˜å¤©æ‰“ç®—åš:
`;

            (data.tomorrow_plan || []).forEach((plan, i) => {
                text += `  ${i + 1}. ${plan}\n`;
            });

            if (data.insights) {
                text += `\nğŸ’­ æ„Ÿæ‚Ÿ:\n${data.insights}\n`;
            }

            if (data.focus_sessions && data.focus_sessions.length > 0) {
                const total = data.focus_sessions.reduce((sum, s) => sum + s.duration, 0);
                text += `\nâ±ï¸  ä»Šæ—¥ä¸“æ³¨æ—¶é•¿: ${total}åˆ†é’Ÿ\n`;
                text += 'ğŸ“Š ä¸“æ³¨è®°å½•:\n';
                data.focus_sessions.forEach(session => {
                    text += `  â€¢ ${session.duration}åˆ†é’Ÿ - ${session.task}\n`;
                });
            }

            text += '\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([text], {
                type: 'text/plain;charset=utf-8'
            });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `record_${dateStr}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // å¯åŠ¨åº”ç”¨
        init();
    </script>

</body>

</html>